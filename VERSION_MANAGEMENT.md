# バージョン管理ガイド

## 概要

このアプリケーションは、セマンティックバージョニング（Semantic Versioning）に従ってバージョン管理されています。

## バージョン番号の形式

`MAJOR.MINOR.PATCH` (例: 1.2.3)

- **MAJOR**: 互換性のない大幅な変更
- **MINOR**: 後方互換性のある新機能の追加
- **PATCH**: 後方互換性のあるバグ修正

## 現在の実装

### ファイル構成

1. **package.json**: アプリケーションの公式バージョン
2. **public/version-check.js**: ブラウザでのバージョンチェック用
3. **src/utils/version.ts**: バージョン情報の表示用ユーティリティ
4. **src/App/AboutUs.tsx**: ユーザー向けバージョン表示

### 自動バージョンチェック機能

- ユーザーがアプリにアクセスすると、`version-check.js`が実行される
- ローカルストレージに保存されたバージョンと現在のバージョンを比較
- バージョンが異なる場合、キャッシュをクリアしてページをリロード
- 新しいバージョンをローカルストレージに保存

## バージョン更新手順

### 方法1: 自動スクリプトを使用（推奨）

```bash
# マイナーアップデート（新機能追加）
node scripts/update-version.js minor "新しいフィルター機能を追加"

# パッチアップデート（バグ修正）
node scripts/update-version.js patch "マップ表示の不具合を修正"

# メジャーアップデート（大幅な変更）
node scripts/update-version.js major "UI を全面リニューアル"
```

### 方法2: 手動更新

1. **package.json**のversionフィールドを更新
2. **public/version-check.js**のcurrentVersionを同じ値に更新
3. **CHANGELOG.md**に変更内容を記録

## バージョン更新の影響

### ユーザー側
- アプリにアクセスすると自動的に新しいバージョンが検出される
- キャッシュがクリアされ、最新のコンテンツが表示される
- 「このアプリについて」ページで現在のバージョンを確認可能

### 開発者側
- バージョン履歴がCHANGELOG.mdに自動記録される
- Gitコミット時にバージョン情報が含まれる
- デプロイ後、ユーザーに自動的に新しいバージョンが配信される

## バージョン表示

### ユーザー向け表示
- **AboutUsページ**: 現在のバージョン、詳細情報、インストール済みバージョンを表示
- **簡潔表示**: `v1.0.0`
- **詳細表示**: `v1.0.0 (2024-01-15)`

### 開発者向け情報
- ビルド日時
- 環境情報（development/production）
- ローカルストレージの状態

## ベストプラクティス

### バージョンアップのタイミング

1. **パッチ (x.x.1)**
   - バグ修正
   - 軽微な表示調整
   - パフォーマンス改善

2. **マイナー (x.1.x)**
   - 新機能追加
   - 新しいページやコンポーネント
   - API機能拡張

3. **メジャー (1.x.x)**
   - UI/UXの大幅な変更
   - 互換性のない変更
   - アーキテクチャの大幅な変更

### リリースフロー

1. 開発・テスト
2. バージョン更新スクリプト実行
3. 変更内容の確認
4. Gitコミット・プッシュ
5. ビルド・デプロイ
6. ユーザーアクセス時に自動更新

## トラブルシューティング

### よくある問題

1. **無限リロード**
   - package.jsonとversion-check.jsのバージョンが一致しているか確認
   - ローカルストレージをクリアして再テスト

2. **バージョンが表示されない**
   - src/utils/version.tsのインポートが正しいか確認
   - ビルドエラーがないか確認

3. **キャッシュがクリアされない**
   - Service Workerの登録状況を確認
   - ブラウザの開発者ツールでキャッシュ状況を確認

## 今後の拡張予定

- [ ] 自動デプロイ時のバージョン自動更新
- [ ] ユーザー通知機能（新バージョンリリース時）
- [ ] バージョン履歴の詳細表示
- [ ] ロールバック機能