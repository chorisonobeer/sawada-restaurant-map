# パッケージセキュリティおよび更新監査レポート

## 概要
現在のシステム (`sawada-restaurant-map`) の依存関係におけるセキュリティ脆弱性と整合性を監査しました。
システムの安定動作とAPIの安全性を最優先とし、**破壊的な変更を伴うメジャーアップデート（Example: React 18への移行など）は避け、脆弱性の修正と不整合の解消のみを行う**方針を推奨します。

## 1. 検出されたセキュリティ脆弱性と対応策

`npm audit` の実行結果、以下のHigh Severity（高危険度）脆弱性が検出されました。これらは主に `react-scripts` などのビルドツールが内部で依存している古いパッケージに起因します。

| パッケージ名 | 脆弱性タイプ | 深刻度 | 影響 |
| --- | --- | --- | --- |
| `glob` | Command Injection | **High** | CLI使用時の特定の引数処理におけるインジェクション |
| `node-forge` | ASN.1 / OID Issues | **High** | 暗号化処理における無限再帰や検証不整合 |
| `nth-check` | ReDoS (正規表現DO S) | **High** | `svgo` などを経由して依存。ビルドパフォーマンスへの影響 |

### 推奨対応: `overrides` の利用
`npm audit fix` は破壊的な変更（`react-scripts` のバージョン変更など）を引き起こす可能性があるため推奨しません。
代わりに、`package.json` に `overrides` フィールドを追加し、問題のある依存パッケージのみをピンポイントで安全なバージョンに強制更新する方法を推奨します。

```json
{
  "overrides": {
    "glob": "^10.4.5",
    "node-forge": "^1.3.1",
    "nth-check": "^2.0.1",
    "postcss": "^8.4.31"
  }
}
```
※ `node-forge` は `^1.3.0` 以上が推奨されますが、互換性のため慎重に指定します。

## 2. パッケージ整合性の確認

### `react-router-dom` の型定義不整合
- **現状**: `react-router-dom` (v6.2.2) がインストールされていますが、型定義ファイル `@types/react-router-dom` (v5.3.3) が残っています。
- **問題**: バージョン v5 と v6 ではAPIが大きく異なるため、TypeScriptの型チェックが正しく機能しない、または存在しないAPIを参照してしまうリスクがあります。
- **対応**: `react-router-dom` v6 は型定義を内包しているため、`@types/react-router-dom` は不要です。**削除**を推奨します。

### `@material-ui/core` (MUI) の状況
- **現状**: `"@material-ui/core": "^5.0.0-beta.5"` を使用しています。
- **分析**: MUI v5 の正式版は `@mui/material` というパッケージ名に変更されました。現在の beta 版は開発が停止しています。
- **判断**: 正式版への移行はコードベース全体（importパスやスタイル定義）の書き換えを伴う大規模な変更となります。システムの安定性を優先し、**今回は維持**とします。

## 3. 推奨アクションプラン

以下の手順で修正を行うことで、システムを破壊することなく安全性を向上させることができます。

1.  **`package.json` の編集**:
    -   `dependencies` から `"@types/react-router-dom"` を削除。
    -   `overrides` フィールドを追加（上記参照）。
2.  **インストールの実行**:
    -   `npm install` を実行し、`package-lock.json` を更新。
3.  **動作確認**:
    -   `npm start` でアプリケーションが起動することを確認。
    -   主要な画面遷移（Map表示など）を確認。

## 4. 将来的な課題（参考）
- **React 18**: 現状 v17 ですが、v18 への移行は並行レンダリングなどの恩恵があります。しかし破壊的変更があるため、別途計画的な移行が必要です。
- **MUI v5 Stable**: セキュリティとメンテナンス性の観点から、将来的には `@mui/material` への移行が強く推奨されます。
