# パッケージセキュリティ監査報告書 (2025年12月版)

## 1. はじめに
本ドキュメントは、現在のシステム（sawada-restaurant-map）におけるパッケージの依存関係、セキュリティ状態、および更新の必要性について調査した結果をまとめたものです。
**「システムの破綻が発生しないこと」「API連携の安全確保」**を最優先とし、無闇なバージョンアップではなく、現状のリスク評価と安定運用のための推奨事項を提示します。

## 2. 現状のシステム構成と依存関係分析

現在の主要な技術スタックとバージョンの状態は以下の通りです。

| パッケージ | 現在のバージョン | 最新安定版 (参考) | 状態・リスク |
| :--- | :--- | :--- | :--- |
| **react** | `^17.0.2` | v18.x / v19.x | **EOL (End of Life) だがセキュリティパッチは提供継続中**。v18への移行は破壊的変更を伴うため、慎重な計画が必要。 |
| **react-scripts** | `5.0.1` | - | **メンテナンス停滞**。Create React App (CRA) は現在非推奨傾向にあり、脆弱性の修正も遅れている。将来的には Vite への移行が推奨される。 |
| **@material-ui/core** | `^5.0.0-beta.5` | v5 (Stable) / v6 | **リスク高**。正式リリース前のBeta版であり、パッケージ名も現在は `@mui/material` に変更されている。長期的な保守性に懸念あり。 |
| **typescript** | `~4.9.5` | v5.x | 古いが安定して動作中。急いで上げる必要性は低い。 |
| **node-fetch** | `2` | v3 | Netlify Functions 上で Node.js 18+ が動いている場合、組み込みの `fetch` が使用可能なため、パッケージ自体が不要な可能性がある。 |

## 3. 脆弱性スキャン結果 (npm audit)

`npm audit` の実行結果、**12件の脆弱性（High: 8, Moderate: 4）**が検出されました。

- **主な要因**: `react-scripts` が依存している `webpack-dev-server` や `nth-check` 等の古いバージョン。
- **影響範囲**: これらは主に**開発時（ローカル起動時やビルド時）に使用されるツール**に含まれる脆弱性です。生成される静的ファイル（本番サイト）に直接悪意のあるコードが含まれるリスクは低いですが、開発環境のセキュリティリスクとなります。
- **対応の難易度**: `react-scripts` が内部でバージョンを固定しているため、単純な `npm update` では解消できません。`npm audit fix --force` は**システムを破壊する可能性が極めて高い**ため、絶対に実行しないでください。

## 4. 推奨される対応方針

「システムの安定性」を最優先とするため、**現時点での大幅なパッケージアップデートは推奨しません。**
以下のフェーズに分けた対応を提案します。

### ✅ フェーズ1: 現状維持と監視 (推奨: 即時)
- **判定**: **パッケージのアップロード・インストールは「不要」です。**
- **理由**: 現在稼働しているシステムに対し、ReactやMUIのバージョンを上げることは、API連携（Mapbox/Geolonia等）やUI描画に予期せぬ不具合をもたらすリスクが大きすぎます。
- **アクション**: 
    - `npm audit fix` 系コマンドの実行禁止をチーム内で共有する。
    - 現在の `package-lock.json` を厳重に管理し、意図しない更新を防ぐ。

### ⚠️ フェーズ2: クリーンアップ (推奨: 余裕がある時)
- 使われていない可能性が高いパッケージの削除を検討します。
    - **`axios`**: `src` 内で使用箇所が見当たりません（`devDependencies`）。削除しても副作用がないか確認した上で削除を推奨します。
    - **`node-fetch`**: Netlify Functions (`image-proxy.js`) は `fetch` を使用していますが、これはNode.js標準機能である可能性が高いです。動作検証環境でパッケージを外して動作すれば、依存を減らせます。

### 🚀 フェーズ3: 将来的な計画 (推奨: 次期リニューアル時)
- **MUIの正規化**: `@material-ui/core` (Beta) から `@mui/material` (Stable) への移行。パッケージ名の置換とスタイリング定義の修正が必要です。
- **ビルドツールの移行**: `react-scripts` から `Vite` への移行。これにより、多くの潜在的な脆弱性が解消され、ビルド速度も向上します。

## 5. 結論

システム破綻を防ぐため、**現状はパッケージの追加・更新を行わないこと**を強く推奨します。
特にセキュリティツールが提案する自動修正は、このプロジェクト構成においては**破壊的**です。

現在の構成は古くなっていますが、動作実績があります。セキュリティリスクは主に開発環境にあることを理解し、本番環境への影響は限定的であると判断します。
次回の機能追加や大規模改修のタイミングで、フェーズ3のモダン化を実施するのが最も安全かつ効率的なアプローチです。
