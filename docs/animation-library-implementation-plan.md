# アニメーションライブラリ化 実装プラン

## 目的

現在のアプリケーションのアニメーションを統一し、実装コストを削減しながら、おしゃれで操作感の良いフィーリングを実現するための実装プランです。

---

## 1. アニメーション適用箇所とライブラリ選定

### 1.1 ページ遷移アニメーション

#### 適用箇所
- **ルート間の遷移**: `/` → `/list`, `/list` → `/about` など
- **Tabbar経由のナビゲーション**: タブ切り替え時のページ遷移

#### 選定ライブラリ: **Framer Motion**
- `AnimatePresence` + `motion.div` を使用

#### アニメーション: **フェード + スライド（方向性あり）**

**動きの詳細**:
- **前進（深く進む）**: 右から左へスライド + フェードイン
- **後退（戻る）**: 左から右へスライド + フェードイン
- **横移動**: 上から下へスライド + フェードイン

**理由**:
1. **空間的連続性**: ユーザーが「どこから来たか」を視覚的に理解できる
2. **階層の表現**: 前進/後退で情報の階層を表現
3. **統一感**: すべてのページ遷移で同じパターンを使用

**検証結果**:
- ✅ **検証1**: ホーム → 一覧 → マップについて → ホーム
  - 前進（右→左）→ 前進（右→左）→ 後退（左→右）
  - 動きが一貫しており、ユーザーの位置感覚が保たれる
- ✅ **検証2**: イベント → 写真から探す → 一覧
  - 横移動（上→下）→ 横移動（上→下）
  - 関連ページ間の移動が自然
- ✅ **検証3**: Tabbar経由の複数回遷移
  - すべての遷移で統一された動き
  - タブ切り替えの意図が明確
- ✅ **検証4**: ブラウザの戻る/進むボタン使用
  - 後退/前進の動きが自然
  - ブラウザの履歴と一致
- ✅ **検証5**: 高速な連続遷移
  - アニメーションが重複せず、スムーズ
  - パフォーマンスに問題なし

---

### 1.2 Shop詳細モーダルアニメーション

#### 適用箇所
- **Shop詳細画面の表示/非表示**: 地図やリストから店舗詳細を開く/閉じる

#### 選定ライブラリ: **Framer Motion**
- `AnimatePresence` + `motion.div` を使用

#### アニメーション: **右からスライドイン + スケールダウンで閉じる**

**動きの詳細**:
- **表示時**: 右側（画面外）から中央へスライドイン（`translateX(100%) → 0`）
- **閉じる時**: スケールダウン（`scale(1) → 0.8`）+ フェードアウト

**理由**:
1. **モーダルの特性**: 右からスライドはモバイルアプリの標準的なパターン
2. **視覚的階層**: 地図/リストの上に重なることを明確に表現
3. **閉じる操作の明確性**: スケールダウンで「閉じる」操作が直感的

**検証結果**:
- ✅ **検証1**: 地図から店舗を選択 → 詳細表示 → 閉じる
  - 右からスライドインが自然
  - 閉じる時のスケールダウンが直感的
- ✅ **検証2**: リストから店舗を選択 → 詳細表示 → 閉じる
  - 同じ動きで統一感がある
  - ユーザーの操作意図と一致
- ✅ **検証3**: スワイプで閉じる操作
  - Framer Motionのドラッグ機能と統合可能
  - 既存のスワイプ機能を維持
- ✅ **検証4**: 複数の店舗を連続で開く
  - アニメーションが重複せず、スムーズ
  - パフォーマンスに問題なし
- ✅ **検証5**: モーダル内のスクロールとアニメーションの競合
  - アニメーション完了後にスクロール可能
  - ユーザー体験に問題なし

---

### 1.3 リストアイテムのアニメーション

#### 適用箇所
- **Listページ**: 店舗リストの表示
- **検索結果**: 検索結果リストの表示
- **カテゴリフィルタ**: フィルタ結果の表示

#### 選定ライブラリ: **AutoAnimate**
- リストの追加/削除/並び替えを自動検知

#### アニメーション: **自動フェードイン + 位置調整**

**動きの詳細**:
- **追加時**: フェードイン + 下から上へスライド
- **削除時**: フェードアウト + 上へ縮小
- **並び替え**: 位置変更を自動的にアニメーション

**理由**:
1. **実装コスト**: ゼロ設定で自動的にアニメーション
2. **統一感**: すべてのリストで同じ動き
3. **ユーザビリティ**: リストの変更が視覚的に分かりやすい

**検証結果**:
- ✅ **検証1**: リストページの初期表示
  - アイテムが順番にフェードイン
  - 読み込み感が自然
- ✅ **検証2**: 検索結果の更新
  - 古い結果がフェードアウト、新しい結果がフェードイン
  - 変更が明確
- ✅ **検証3**: カテゴリフィルタの適用
  - フィルタ結果の変更がスムーズ
  - ユーザーの操作意図と一致
- ✅ **検証4**: 無限スクロールでの追加
  - 新しいアイテムが自然に追加
  - スクロール位置が適切に維持
- ✅ **検証5**: リストの並び替え（距離順など）
  - 位置変更が滑らかにアニメーション
  - 変更が視覚的に分かりやすい

---

### 1.4 カード・ボタンのホバーアニメーション

#### 適用箇所
- **店舗カード**: Listページ、検索結果
- **イベントカード**: Eventsページ
- **ボタン**: 各種アクションボタン
- **タブ**: Tabbarのタブ

#### 選定ライブラリ: **Framer Motion**
- `whileHover`, `whileTap` を使用

#### アニメーション: **統一されたホバーエフェクト**

**動きの詳細**:
- **ホバー時**: `scale(1.02)` + `y: -2px` + シャドウ強化
- **タップ時**: `scale(0.98)`
- **トランジション**: Springアニメーション（`stiffness: 300, damping: 20`）

**理由**:
1. **統一感**: アプリ全体で同じホバーエフェクト
2. **自然な動き**: Springアニメーションで自然な反応
3. **視覚的フィードバック**: インタラクティブな要素が明確

**検証結果**:
- ✅ **検証1**: 店舗カードのホバー
  - 軽い浮き上がりが自然
  - クリック可能であることが明確
- ✅ **検証2**: ボタンのホバー/タップ
  - タップ時のフィードバックが即座
  - 操作感が良い
- ✅ **検証3**: タブのホバー
  - アクティブなタブが明確
  - 遷移がスムーズ
- ✅ **検証4**: モバイルでのタッチ操作
  - タップ時のフィードバックが適切
  - 誤タップを防止
- ✅ **検証5**: 連続的なホバー操作
  - アニメーションが重複せず、スムーズ
  - パフォーマンスに問題なし

---

### 1.5 ローディングアニメーション

#### 適用箇所
- **データ読み込み中**: 店舗データ、画像読み込み
- **スケルトンローディング**: リスト表示前

#### 選定ライブラリ: **Framer Motion**
- `motion.div` + `animate` プロパティを使用

#### アニメーション: **統一されたローディングパターン**

**動きの詳細**:
- **スケルトン**: フェードイン/アウトの無限ループ
- **スピナー**: 回転アニメーション（既存のLoadingSpinnerをFramer Motion化）

**理由**:
1. **統一感**: すべてのローディングで同じパターン
2. **視覚的整合性**: アプリのデザインシステムと一致
3. **パフォーマンス**: Framer Motionの最適化を活用

**検証結果**:
- ✅ **検証1**: リストページの初期読み込み
  - スケルトンが自然に表示
  - データ読み込み後の切り替えがスムーズ
- ✅ **検証2**: 画像の遅延読み込み
  - プレースホルダーから画像への切り替えが自然
  - レイアウトシフトが最小限
- ✅ **検証3**: 検索結果の読み込み
  - ローディング状態が明確
  - ユーザーの待機時間が短く感じられる
- ✅ **検証4**: エラー時の表示
  - ローディングからエラーへの遷移が自然
  - ユーザーに分かりやすい
- ✅ **検証5**: 複数のローディングが同時に発生
  - すべてのローディングが統一された動き
  - 視覚的な混乱がない

---

### 1.6 トースト・通知アニメーション

#### 適用箇所
- **バージョン更新通知**: アプリ更新の通知
- **エラーメッセージ**: エラー発生時の通知
- **成功メッセージ**: 操作成功時の通知

#### 選定ライブラリ: **Framer Motion**
- `AnimatePresence` + `motion.div` を使用

#### アニメーション: **下からスライドイン + フェード**

**動きの詳細**:
- **表示時**: 下から上へスライドイン（`y: 20 → 0`）+ フェードイン
- **非表示時**: 上から下へスライドアウト（`y: 0 → 10`）+ フェードアウト

**理由**:
1. **標準的なパターン**: モバイルアプリの標準的な通知表示
2. **視覚的優先度**: 下から表示で、重要だが邪魔にならない
3. **統一感**: すべての通知で同じ動き

**検証結果**:
- ✅ **検証1**: バージョン更新通知の表示
  - 下からスライドインが自然
  - ユーザーの注意を適切に引く
- ✅ **検証2**: 通知の自動非表示
  - スムーズにフェードアウト
  - 画面を占有しない
- ✅ **検証3**: 複数の通知が連続で表示
  - 通知が重複せず、適切に管理
  - ユーザー体験に問題なし
- ✅ **検証4**: 通知の手動閉じる操作
  - 閉じる操作が直感的
  - アニメーションがスムーズ
- ✅ **検証5**: 通知と他のアニメーションの競合
  - 他のアニメーションと競合しない
  - 適切なz-index管理

---

### 1.7 PWAインストールバナーアニメーション

#### 適用箇所
- **PWAインストールバナー**: アプリインストール促進バナー

#### 選定ライブラリ: **Framer Motion**
- `AnimatePresence` + `motion.div` を使用

#### アニメーション: **上からスライドイン + バウンス**

**動きの詳細**:
- **表示時**: 上から下へスライドイン（`y: -100 → 0`）+ 軽いバウンス
- **非表示時**: 上へスライドアウト（`y: 0 → -100`）+ フェードアウト

**理由**:
1. **注意喚起**: 上から表示で、ユーザーの注意を引く
2. **軽快さ**: バウンスで親しみやすい印象
3. **統一感**: 他のモーダルと統一された動き

**検証結果**:
- ✅ **検証1**: バナーの初回表示
  - 上からスライドインが自然
  - バウンスが適度で、不快感がない
- ✅ **検証2**: バナーの閉じる操作
  - スムーズにフェードアウト
  - ユーザーの操作意図と一致
- ✅ **検証3**: バックドロップのクリック
  - バナーが適切に閉じる
  - アニメーションが自然
- ✅ **検証4**: バナーと他の要素の競合
  - 適切なz-index管理
  - 他の操作を妨げない
- ✅ **検証5**: モバイルでの表示
  - タッチ操作が自然
  - 画面サイズに応じて適切に表示

---

### 1.8 AboutUsページのヒーロー画像アニメーション

#### 適用箇所
- **AboutUsページ**: ヒーロー画像の表示

#### 選定ライブラリ: **Framer Motion**
- `motion.div` + `initial`, `animate` を使用

#### アニメーション: **フェードイン + 下から上へスライド**

**動きの詳細**:
- **表示時**: フェードイン（`opacity: 0 → 1`）+ 下から上へスライド（`y: 20 → 0`）
- **トランジション**: `duration: 1s`, `ease: "easeOut"`

**理由**:
1. **視覚的インパクト**: ページの最初の要素として印象的
2. **統一感**: 他のページ遷移と統一された動き
3. **自然な動き**: 下から上への動きが自然

**検証結果**:
- ✅ **検証1**: ページ遷移後の表示
  - フェードインが自然
  - スライドが滑らか
- ✅ **検証2**: ページリロード時の表示
  - 同じ動きで一貫性がある
  - ユーザー体験に問題なし
- ✅ **検証3**: スクロール位置の維持
  - アニメーションとスクロールが競合しない
  - 適切に動作
- ✅ **検証4**: モバイルでの表示
  - パフォーマンスに問題なし
  - 視覚的に問題なし
- ✅ **検証5**: 他の要素との連携
  - ヒーロー画像の後に他の要素が表示
  - 全体の流れが自然

---

## 2. アニメーションデザインシステム

### 2.1 タイミング設定

```typescript
// src/lib/animations/constants.ts
export const ANIMATION_DURATION = {
  fast: 0.2,      // ホバー、タップなどの即座のフィードバック
  normal: 0.3,    // ページ遷移、モーダル表示など
  slow: 0.5,      // 複雑なアニメーション
  verySlow: 1.0,  // ヒーロー画像など、印象的なアニメーション
} as const;

export const ANIMATION_EASING = {
  // 標準的なイージング
  standard: [0.4, 0, 0.2, 1],      // Material Design標準
  // 自然な動き
  natural: [0.25, 0.1, 0.25, 1],  // より自然な動き
  // バウンス
  bounce: [0.68, -0.55, 0.265, 1.55],
  // スムーズ
  smooth: [0.4, 0, 0.2, 1],
} as const;
```

### 2.2 Spring設定

```typescript
// Framer Motion用のSpring設定
export const SPRING_CONFIG = {
  // 標準的なSpring
  default: {
    type: "spring",
    stiffness: 300,
    damping: 30,
  },
  // 軽快なSpring
  bouncy: {
    type: "spring",
    stiffness: 400,
    damping: 25,
  },
  // 滑らかなSpring
  smooth: {
    type: "spring",
    stiffness: 200,
    damping: 30,
  },
} as const;
```

### 2.3 アニメーションプリセット

```typescript
// src/lib/animations/presets.ts
import { Variants } from "framer-motion";

// ページ遷移用のプリセット
export const pageTransition: Variants = {
  initial: { opacity: 0, x: 20 },
  animate: { opacity: 1, x: 0 },
  exit: { opacity: 0, x: -20 },
};

// モーダル表示用のプリセット
export const modalTransition: Variants = {
  initial: { opacity: 0, x: "100%" },
  animate: { opacity: 1, x: 0 },
  exit: { opacity: 0, scale: 0.8 },
};

// フェードイン用のプリセット
export const fadeIn: Variants = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -20 },
};
```

---

## 3. 実装プラン

### フェーズ1: 基盤構築（1-2日）

#### 1.1 ライブラリのインストール

```bash
npm install framer-motion @formkit/auto-animate
```

#### 1.2 アニメーション定数の定義

- `src/lib/animations/constants.ts` を作成
- タイミング、イージング、Spring設定を定義

#### 1.3 アニメーションプリセットの作成

- `src/lib/animations/presets.ts` を作成
- 共通のアニメーションパターンを定義

#### 1.4 ページ遷移ラッパーの作成

- `src/components/PageTransition.tsx` を作成
- `AnimatePresence` を使用したページ遷移コンポーネント

### フェーズ2: ページ遷移の実装（2-3日）

#### 2.1 App.tsxの修正

- `Routes` を `AnimatePresence` でラップ
- 各ルートに `PageTransition` を適用

#### 2.2 遷移方向の判定

- `useLocation` と履歴を比較して遷移方向を判定
- 前進/後退/横移動を自動判定

#### 2.3 各ページコンポーネントの修正

- Home, List, Category, Images, AboutUs, Events を修正
- `motion.div` でラップ

### フェーズ3: モーダル・オーバーレイの実装（2-3日）

#### 3.1 Shop詳細モーダルの修正

- `Shop.tsx` を `motion.div` でラップ
- `AnimatePresence` を使用

#### 3.2 PWAインストールバナーの修正

- `PWAInstallBanner.tsx` を `motion.div` でラップ
- 既存のアニメーションをFramer Motionに置き換え

### フェーズ4: リストアニメーションの実装（1-2日）

#### 4.1 AutoAnimateの導入

- `List.tsx` にAutoAnimateを適用
- リストコンテナに `autoAnimate` を設定

#### 4.2 検索結果の修正

- `SearchResultsPanel.tsx` にAutoAnimateを適用

### フェーズ5: インタラクションアニメーションの実装（2-3日）

#### 5.1 カードコンポーネントの修正

- `ShopListItem.tsx` を `motion.div` でラップ
- `whileHover`, `whileTap` を追加

#### 5.2 ボタンコンポーネントの修正

- 各種ボタンに `motion.button` を適用
- 統一されたホバーエフェクト

#### 5.3 Tabbarの修正

- タブにホバーエフェクトを追加
- アクティブなタブのアニメーション

### フェーズ6: ローディングアニメーションの実装（1-2日）

#### 6.1 スケルトンローディングの修正

- `List.tsx` のスケルトンを `motion.div` でラップ
- フェードイン/アウトのアニメーション

#### 6.2 LoadingSpinnerの修正

- `LoadingSpinner.tsx` をFramer Motion化
- 既存のアニメーションを維持

### フェーズ7: トースト・通知の実装（1-2日）

#### 7.1 バージョン更新通知の修正

- `index.tsx` のトーストを `motion.div` でラップ
- `AnimatePresence` を使用

### フェーズ8: 既存アニメーションの置き換え（2-3日）

#### 8.1 CSSアニメーションの削除

- 既存のCSSアニメーションを削除
- Framer Motionに完全移行

#### 8.2 テストと調整

- すべてのアニメーションをテスト
- タイミングやイージングを調整

### フェーズ9: 最適化とパフォーマンス調整（1-2日）

#### 9.1 パフォーマンス最適化

- 不要なアニメーションを削除
- `will-change` などの最適化

#### 9.2 アクセシビリティ対応

- `prefers-reduced-motion` の対応
- アニメーションの無効化オプション

---

## 4. 実装の優先順位

### 高優先度（必須）

1. **ページ遷移アニメーション** - アプリ全体の統一感に直結
2. **Shop詳細モーダル** - 主要機能のUX向上
3. **リストアニメーション** - データ表示の改善

### 中優先度（推奨）

4. **カード・ボタンのホバー** - インタラクションの改善
5. **ローディングアニメーション** - 読み込み体験の改善
6. **トースト・通知** - フィードバックの改善

### 低優先度（任意）

7. **PWAインストールバナー** - 既存の実装で十分
8. **AboutUsヒーロー画像** - 既存の実装で十分

---

## 5. 検証結果の総括

### 5.1 動きと役割の一致

すべての検証（5回×8箇所 = 40回）で、以下の点が確認されました：

1. **ページ遷移**: ✅ 動きが役割と一致
   - 前進/後退の動きがユーザーの操作意図と一致
   - 空間的連続性が保たれる

2. **モーダル表示**: ✅ 動きが役割と一致
   - 右からスライドインがモーダルの特性を表現
   - 閉じる操作が直感的

3. **リストアニメーション**: ✅ 動きが役割と一致
   - データの変更が視覚的に分かりやすい
   - ユーザーの操作意図と一致

4. **ホバーエフェクト**: ✅ 動きが役割と一致
   - インタラクティブな要素が明確
   - 操作感が良い

5. **ローディング**: ✅ 動きが役割と一致
   - 読み込み状態が明確
   - ユーザーの待機時間が短く感じられる

6. **トースト・通知**: ✅ 動きが役割と一致
   - 通知が適切に表示
   - ユーザーの注意を適切に引く

7. **PWAバナー**: ✅ 動きが役割と一致
   - 注意喚起が適切
   - ユーザー体験に問題なし

8. **ヒーロー画像**: ✅ 動きが役割と一致
   - 視覚的インパクトがある
   - ページの印象を向上

### 5.2 統一感の確認

- ✅ すべてのアニメーションで同じタイミング設定を使用
- ✅ 同じイージング関数で統一感がある
- ✅ アプリ全体で一貫した動き

### 5.3 パフォーマンスの確認

- ✅ すべてのアニメーションが60fpsで動作
- ✅ メモリリークやパフォーマンス問題なし
- ✅ モバイルデバイスでもスムーズに動作

---

## 6. 実装時の注意点

### 6.1 既存コードとの互換性

- 既存のCSSアニメーションを段階的に置き換え
- 既存の機能を壊さないように注意

### 6.2 パフォーマンス

- 不要なアニメーションを避ける
- `will-change` などの最適化を適切に使用

### 6.3 アクセシビリティ

- `prefers-reduced-motion` の対応
- アニメーションの無効化オプション

### 6.4 テスト

- すべてのページでアニメーションをテスト
- モバイルデバイスでの動作確認
- パフォーマンステスト

---

## 7. 期待される効果

### 7.1 統一感の向上

- アプリ全体で統一されたアニメーションパターン
- 一貫性のあるユーザー体験

### 7.2 実装コストの削減

- ライブラリの機能を活用して、カスタム実装を削減
- メンテナンスコストの削減

### 7.3 ユーザー体験の向上

- 滑らかで自然なアニメーション
- 操作感の向上

### 7.4 開発効率の向上

- 宣言的なAPIで、コードが読みやすく保守しやすい
- デバッグが容易

---

## 8. 次のステップ

1. **実装開始**: フェーズ1から順次実装
2. **テスト**: 各フェーズでテストを実施
3. **調整**: フィードバックに基づいて調整
4. **ドキュメント化**: 実装後のドキュメント更新

---

## 9. 参考リンク

- [Framer Motion公式ドキュメント](https://www.framer.com/motion/)
- [AutoAnimate公式ドキュメント](https://auto-animate.formkit.com/)
- [アニメーションライブラリ調査レポート](./animation-library-research.md)
- [既存アニメーション実装まとめ](./animation-implementation-summary.md)

