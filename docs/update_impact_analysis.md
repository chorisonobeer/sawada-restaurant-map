# システム改善・最新化による影響分析レポート

## 概要
本レポートは、現在の `sawada-restaurant-map` システムに対して、主要パッケージのアップデート、ツール移行、およびリファクタリングを実施した場合の**改善効果（メリット）**と**リスク**を分析したものです。
「破壊的な変更は最小限に抑えつつ、最大の効果を得る」視点で評価を行いました。

## 1. ビルドツールの移行 (Create React App -> Vite)
現在使用している `react-scripts` (Create React App) は開発が事実上停止しており、ビルド速度も低速です。これを最新の標準ツールである **Vite** に移行することによる影響です。

### 改善される点 (メリット)
*   **開発サーバー起動の爆速化**: 現在数秒〜数十秒かかっている起動が、**300ms程度**になります。
*   **HMR (ホットリロード) の即時反映**: コード編集時のブラウザ反映が、ファイル数が増えても一瞬で行われます。これにより開発効率が劇的に向上します。
*   **ビルド時間の短縮**: 本番ビルドの時間が大幅に短縮されます。
*   **セキュリティ**: 古い依存関係 (`webpack-dev-server` の脆弱性など) から脱却でき、セキュリティリスクが恒久的に低減します。

### リスクとコスト
*   **移行コスト (低〜中)**: 環境変数 (`REACT_APP_` -> `VITE_`) のプレフィックス変更や、`index.html` の移動などの調整が必要です。既存コードへの論理的な破壊はありません。

---

## 2. React 18 へのアップグレード (v17 -> v18)
現在の v17 から v18 へアップデートすることによる影響です。

### 改善される点 (メリット)
*   **Automatic Batching (自動バッチ処理)**: 複数のステート更新が自動的に1つの再レンダリングにまとめられます。これにより**無駄なレンダリングが減り、アプリの動作が軽快になります**（特に地図操作やフィルタリング時）。
*   **Concurrent Features (並行レンダリング)**: 将来的に重い処理（大量の店舗データのフィルタリングなど）を裏で行い、UIをフリーズさせない実装が可能になります。

### リスクとコスト
*   **移行コスト (低)**: エントリーポイント (`index.tsx`) の書き換え (`createRoot`) が必要です。
*   **Strict Mode**: `useEffect` が開発モードで2回走るようになりますが、これはバグ発見のための仕様であり、適切に対応することでコード品質が上がります。

---

## 3. UIライブラリの安定化 (MUI v5 Beta -> Stable)
現在 `beta` 版で止まっている `@material-ui/core` を、正規の `@mui/material` に移行する影響です。

### 改善される点 (メリット)
*   **バグ修正と安定性**: Beta版に含まれていた既知のバグが解消されます。
*   **スタイリングの最適化**: 新しいスタイリングエンジン (`emotion` ベースの最適化) により、CSSの生成コストが下がり、描画パフォーマンスが向上します。
*   **ドキュメントとの整合性**: 公式ドキュメント通りのコードがそのまま動作するようになり、保守が容易になります。

### リスクとコスト
*   **移行コスト (中)**: パッケージ名変更 (`@material-ui/core` -> `@mui/material`) に伴い、**全ファイルの `import` 文の書き換え**が必要です。自動変換ツール(`codemod`)である程度対応可能ですが、目視確認が必要です。

---

## 4. コードのリファクタリング (コンポーネント分割と型安全化)
現在は1ファイルにロジックが集中している箇所や、型定義が緩い箇所が見受けられます。

### 改善される点 (メリット)
*   **可読性と保守性**: `App.tsx` などに集中しているロジックをカスタムフック (`useShopData` など) に切り出すことで、どこで何をしているかが明確になります。
*   **バグの未然防止**: `any` 型を減らし、厳密な型定義を行うことで、「実行してみて初めてクラッシュする」事故を防げます。
*   **テスト容易性**: ロジックが分離されることで、単体テストが書きやすくなります。

---

## 総合評価・推奨ロードマップ

| 施策 | 推定効果 (Perf/DX) | リスク/手間 | 優先度 | コメント |
| :--- | :--- | :--- | :--- | :--- |
| **1. Vite への移行** | **特大** | 小 | **最高** | コードロジックを変えずに開発体験を劇的に改善できるため、最初に行うべきです。 |
| **2. React 18 化** | 大 | 小 | 高 | Vite移行後に行うのがスムーズです。パフォーマンス向上が見込めます。 |
| **3. MUI Stable 化** | 中 | 中 | 中 | ファイル変更数が多いため、機能追加が落ち着いたタイミングで実施を推奨します。 |

**結論**:
まずは **Vite への移行** を実施することを強くお勧めします。これにより開発環境のレスポンスが改善され、その後のリファクタリングや機能追加もスムーズに行えるようになります。
